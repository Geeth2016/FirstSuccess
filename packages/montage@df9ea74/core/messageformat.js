(function(e){function t(e,n){var i;if(e&&n&&(t.locale[e]=n),i=e=e||"en",n=n||t.locale[i=t.Utils.getFallbackLocale(e)],!n)throw Error("Plural Function not found for locale: "+e);this.pluralFunc=n,this.locale=e,this.fallbackLocale=i}t.locale={en:function(e){return 1===e?"one":"other"}},t.SafeString=function(e){this.string=e},t.SafeString.prototype.toString=function(){return""+this.string},t.Utils={numSub:function(e,t,n){return e.replace(/^#|[^\\]#/g,function(e){var i=e&&2===e.length?e.charAt(0):"";return i+'" + (function(){ var x = '+t+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+n+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(e){var n={"\n":"\\n",'"':'\\"'},i=/[\n"]/g,r=/[\n"]/,o=function(e){return n[e]||"&amp;"};return e instanceof t.SafeString?""+e:null===e||e===!1?"":r.test(e)?e.replace(i,o):e},getFallbackLocale:function(e){for(var n=e.indexOf("-")>=0?"-":"_";!t.locale.hasOwnProperty(e);)if(e=e.substring(0,e.lastIndexOf(n)),0===e.length)return null;return e}};var n=function(){var e={parse:function(e,t){function n(e,t,n){for(var i=e,r=n-e.length,o=0;r>o;o++)i=t+i;return i}function i(e){var t=e.charCodeAt(0);if(255>=t)var i="x",r=2;else var i="u",r=4;return"\\"+i+n(t.toString(16).toUpperCase(),"0",r)}function r(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,i)+'"'}function o(e){x>D||(D>x&&(x=D,k=[]),k.push(e))}function a(){var e="start@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=s(),r=null!==i?function(e){return{type:"program",program:e}}(i):null;if(null!==r)var o=r;else{var o=null;D=n}return A[e]={nextPos:D,result:o},o}function s(){var e="messageFormatPattern@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=D,r=_();if(null!==r){for(var o=[],a=l();null!==a;){o.push(a);var a=l()}if(null!==o)var s=[r,o];else{var s=null;D=i}}else{var s=null;D=i}var u=null!==s?function(e,t){var n=[];e&&e.val&&n.push(e);for(var i in t)t.hasOwnProperty(i)&&n.push(t[i]);return{type:"messageFormatPattern",statements:n}}(s[0],s[1]):null;if(null!==u)var c=u;else{var c=null;D=n}return A[e]={nextPos:D,result:c},c}function l(){var t="messageFormatPatternRight@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=D;if("{"===e.substr(D,1)){var a="{";D+=1}else{var a=null;L&&o('"{"')}if(null!==a){var s=M();if(null!==s){var l=u();if(null!==l){var c=M();if(null!==c){if("}"===e.substr(D,1)){var d="}";D+=1}else{var d=null;L&&o('"}"')}if(null!==d){var h=_();if(null!==h)var p=[a,s,l,c,d,h];else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}var f=null!==p?function(e,t){var n=[];return e&&n.push(e),t&&t.val&&n.push(t),{type:"messageFormatPatternRight",statements:n}}(p[2],p[5]):null;if(null!==f)var v=f;else{var v=null;D=i}return A[t]={nextPos:D,result:v},v}function u(){var t="messageFormatElement@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=D,a=b();if(null!==a){var s=D;if(","===e.substr(D,1)){var l=",";D+=1}else{var l=null;L&&o('","')}if(null!==l){var u=c();if(null!==u)var d=[l,u];else{var d=null;D=s}}else{var d=null;D=s}var h=null!==d?d:"";if(null!==h)var p=[a,h];else{var p=null;D=r}}else{var p=null;D=r}var f=null!==p?function(e,t){var n={type:"messageFormatElement",argumentIndex:e};return t&&t.length?n.elementFormat=t[1]:n.output=!0,n}(p[0],p[1]):null;if(null!==f)var v=f;else{var v=null;D=i}return A[t]={nextPos:D,result:v},v}function c(){var t="elementFormat@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=D,a=M();if(null!==a){if("plural"===e.substr(D,6)){var s="plural";D+=6}else{var s=null;L&&o('"plural"')}if(null!==s){var l=M();if(null!==l){if(","===e.substr(D,1)){var u=",";D+=1}else{var u=null;L&&o('","')}if(null!==u){var c=M();if(null!==c){var p=d();if(null!==p){var f=M();if(null!==f)var v=[a,s,l,u,c,p,f];else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}var m=null!==v?function(e,t){return{type:"elementFormat",key:e,val:t.val}}(v[1],v[5]):null;if(null!==m)var g=m;else{var g=null;D=i}if(null!==g)var _=g;else{var b=D,y=D,E=M();if(null!==E){if("select"===e.substr(D,6)){var w="select";D+=6}else{var w=null;L&&o('"select"')}if(null!==w){var P=M();if(null!==P){if(","===e.substr(D,1)){var T=",";D+=1}else{var T=null;L&&o('","')}if(null!==T){var S=M();if(null!==S){var C=h();if(null!==C){var O=M();if(null!==O)var x=[E,w,P,T,S,C,O];else{var x=null;D=y}}else{var x=null;D=y}}else{var x=null;D=y}}else{var x=null;D=y}}else{var x=null;D=y}}else{var x=null;D=y}}else{var x=null;D=y}var k=null!==x?function(e,t){return{type:"elementFormat",key:e,val:t.val}}(x[1],x[5]):null;if(null!==k)var I=k;else{var I=null;D=b}if(null!==I)var _=I;else var _=null}return A[t]={nextPos:D,result:_},_}function d(){var e="pluralStyle@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=p(),r=null!==i?function(e){return{type:"pluralStyle",val:e}}(i):null;if(null!==r)var o=r;else{var o=null;D=n}return A[e]={nextPos:D,result:o},o}function h(){var e="selectStyle@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=v(),r=null!==i?function(e){return{type:"selectStyle",val:e}}(i):null;if(null!==r)var o=r;else{var o=null;D=n}return A[e]={nextPos:D,result:o},o}function p(){var e="pluralFormatPattern@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=D,r=f(),o=null!==r?r:"";if(null!==o){for(var a=[],s=m();null!==s;){a.push(s);var s=m()}if(null!==a)var l=[o,a];else{var l=null;D=i}}else{var l=null;D=i}var u=null!==l?function(e,t){var n={type:"pluralFormatPattern",pluralForms:t};return n.offset=e?e:0,n}(l[0],l[1]):null;if(null!==u)var c=u;else{var c=null;D=n}return A[e]={nextPos:D,result:c},c}function f(){var t="offsetPattern@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=D,a=M();if(null!==a){if("offset"===e.substr(D,6)){var s="offset";D+=6}else{var s=null;L&&o('"offset"')}if(null!==s){var l=M();if(null!==l){if(":"===e.substr(D,1)){var u=":";D+=1}else{var u=null;L&&o('":"')}if(null!==u){var c=M();if(null!==c){var d=w();if(null!==d){var h=M();if(null!==h)var p=[a,s,l,u,c,d,h];else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}}else{var p=null;D=r}var f=null!==p?function(e){return e}(p[5]):null;if(null!==f)var v=f;else{var v=null;D=i}return A[t]={nextPos:D,result:v},v}function v(){var e="selectFormatPattern@"+D,t=A[e];if(t)return D=t.nextPos,t.result;for(var n=D,i=[],r=m();null!==r;){i.push(r);var r=m()}var o=null!==i?function(e){return{type:"selectFormatPattern",pluralForms:e}}(i):null;if(null!==o)var a=o;else{var a=null;D=n}return A[e]={nextPos:D,result:a},a}function m(){var t="pluralForms@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=D,a=M();if(null!==a){var l=g();if(null!==l){var u=M();if(null!==u){if("{"===e.substr(D,1)){var c="{";D+=1}else{var c=null;L&&o('"{"')}if(null!==c){var d=M();if(null!==d){var h=s();if(null!==h){var p=M();if(null!==p){if("}"===e.substr(D,1)){var f="}";D+=1}else{var f=null;L&&o('"}"')}if(null!==f)var v=[a,l,u,c,d,h,p,f];else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}}else{var v=null;D=r}var m=null!==v?function(e,t){return{type:"pluralForms",key:e,val:t}}(v[1],v[5]):null;if(null!==m)var _=m;else{var _=null;D=i}return A[t]={nextPos:D,result:_},_}function g(){var t="stringKey@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=b(),a=null!==r?function(e){return e}(r):null;if(null!==a)var s=a;else{var s=null;D=i}if(null!==s)var l=s;else{var u=D,c=D;if("="===e.substr(D,1)){var d="=";D+=1}else{var d=null;L&&o('"="')}if(null!==d){var h=w();if(null!==h)var p=[d,h];else{var p=null;D=c}}else{var p=null;D=c}var f=null!==p?function(e){return e}(p[1]):null;if(null!==f)var v=f;else{var v=null;D=u}if(null!==v)var l=v;else var l=null}return A[t]={nextPos:D,result:l},l}function _(){var e="string@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=D,r=M();if(null!==r){var o=[],a=D,s=M();if(null!==s){var l=y();if(null!==l){var u=M();if(null!==u)var c=[s,l,u];else{var c=null;D=a}}else{var c=null;D=a}}else{var c=null;D=a}for(;null!==c;){o.push(c);var a=D,s=M();if(null!==s){var l=y();if(null!==l){var u=M();if(null!==u)var c=[s,l,u];else{var c=null;D=a}}else{var c=null;D=a}}else{var c=null;D=a}}if(null!==o)var d=[r,o];else{var d=null;D=i}}else{var d=null;D=i}var h=null!==d?function(e,t){for(var n=[],i=0;t.length>i;++i)for(var r=0;t[i].length>r;++r)n.push(t[i][r]);return{type:"string",val:e+n.join("")}}(d[0],d[1]):null;if(null!==h)var p=h;else{var p=null;D=n}return A[e]={nextPos:D,result:p},p}function b(){var t="id@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D,r=D,a=M();if(null!==a){if(null!==e.substr(D).match(/^[a-zA-Z$_]/)){var s=e.charAt(D);D++}else{var s=null;L&&o("[a-zA-Z$_]")}if(null!==s){var l=[];if(null!==e.substr(D).match(/^[^ 	\n\r,.+={}]/)){var u=e.charAt(D);D++}else{var u=null;L&&o("[^ 	\\n\\r,.+={}]")}for(;null!==u;)if(l.push(u),null!==e.substr(D).match(/^[^ 	\n\r,.+={}]/)){var u=e.charAt(D);D++}else{var u=null;L&&o("[^ 	\\n\\r,.+={}]")}if(null!==l){var c=M();if(null!==c)var d=[a,s,l,c];else{var d=null;D=r}}else{var d=null;D=r}}else{var d=null;D=r}}else{var d=null;D=r}var h=null!==d?function(e,t){return e+(t?t.join(""):"")}(d[1],d[2]):null;if(null!==h)var p=h;else{var p=null;D=i}return A[t]={nextPos:D,result:p},p}function y(){var e="chars@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=D,i=E();if(null!==i)for(var r=[];null!==i;){r.push(i);var i=E()}else var r=null;var o=null!==r?function(e){return e.join("")}(r):null;if(null!==o)var a=o;else{var a=null;D=n}return A[e]={nextPos:D,result:a},a}function E(){var t="char@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D;if(null!==e.substr(D).match(/^[^{}\\\0- 	\n\r]/)){var r=e.charAt(D);D++}else{var r=null;L&&o("[^{}\\\\\\0- 	\\n\\r]")}var a=null!==r?function(e){return e}(r):null;if(null!==a)var s=a;else{var s=null;D=i}if(null!==s)var l=s;else{var u=D;if("\\#"===e.substr(D,2)){var c="\\#";D+=2}else{var c=null;L&&o('"\\\\#"')}var d=null!==c?function(){return"\\#"}():null;if(null!==d)var h=d;else{var h=null;D=u}if(null!==h)var l=h;else{var p=D;if("\\{"===e.substr(D,2)){var f="\\{";D+=2}else{var f=null;L&&o('"\\\\{"')}var v=null!==f?function(){return"{"}():null;if(null!==v)var m=v;else{var m=null;D=p}if(null!==m)var l=m;else{var g=D;if("\\}"===e.substr(D,2)){var _="\\}";D+=2}else{var _=null;L&&o('"\\\\}"')}var b=null!==_?function(){return"}"}():null;if(null!==b)var y=b;else{var y=null;D=g}if(null!==y)var l=y;else{var E=D,w=D;if("\\u"===e.substr(D,2)){var M="\\u";D+=2}else{var M=null;L&&o('"\\\\u"')}if(null!==M){var T=P();if(null!==T){var S=P();if(null!==S){var C=P();if(null!==C){var O=P();if(null!==O)var x=[M,T,S,C,O];else{var x=null;D=w}}else{var x=null;D=w}}else{var x=null;D=w}}else{var x=null;D=w}}else{var x=null;D=w}var k=null!==x?function(e,t,n,i){return String.fromCharCode(parseInt("0x"+e+t+n+i))}(x[1],x[2],x[3],x[4]):null;if(null!==k)var I=k;else{var I=null;D=E}if(null!==I)var l=I;else var l=null}}}}return A[t]={nextPos:D,result:l},l}function w(){var t="digits@"+D,n=A[t];if(n)return D=n.nextPos,n.result;var i=D;if(null!==e.substr(D).match(/^[0-9]/)){var r=e.charAt(D);D++}else{var r=null;L&&o("[0-9]")}if(null!==r)for(var a=[];null!==r;)if(a.push(r),null!==e.substr(D).match(/^[0-9]/)){var r=e.charAt(D);D++}else{var r=null;L&&o("[0-9]")}else var a=null;var s=null!==a?function(e){return parseInt(e.join(""),10)}(a):null;if(null!==s)var l=s;else{var l=null;D=i}return A[t]={nextPos:D,result:l},l}function P(){var t="hexDigit@"+D,n=A[t];if(n)return D=n.nextPos,n.result;if(null!==e.substr(D).match(/^[0-9a-fA-F]/)){var i=e.charAt(D);D++}else{var i=null;L&&o("[0-9a-fA-F]")}return A[t]={nextPos:D,result:i},i}function M(){var e="_@"+D,t=A[e];if(t)return D=t.nextPos,t.result;var n=L;L=!1;for(var i=D,r=[],a=T();null!==a;){r.push(a);var a=T()}var s=null!==r?function(e){return e.join("")}(r):null;if(null!==s)var l=s;else{var l=null;D=i}return L=n,L&&null===l&&o("whitespace"),A[e]={nextPos:D,result:l},l}function T(){var t="whitespace@"+D,n=A[t];if(n)return D=n.nextPos,n.result;if(null!==e.substr(D).match(/^[ 	\n\r]/)){var i=e.charAt(D);D++}else{var i=null;L&&o("[ 	\\n\\r]")}return A[t]={nextPos:D,result:i},i}function S(){function t(e){e.sort();for(var t=null,n=[],i=0;e.length>i;i++)e[i]!==t&&(n.push(e[i]),t=e[i]);switch(n.length){case 0:return"end of input";case 1:return n[0];default:return n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}}var n=t(k),i=Math.max(D,x),o=e.length>i?r(e.charAt(i)):"end of input";return"Expected "+n+" but "+o+" found."}function C(){for(var t=1,n=1,i=!1,r=0;x>r;r++){var o=e.charAt(r);"\n"===o?(i||t++,n=1,i=!1):"\r"===o|"\u2028"===o||"\u2029"===o?(t++,n=1,i=!0):(n++,i=!1)}return{line:t,column:n}}var O={_:M,"char":E,chars:y,digits:w,elementFormat:c,hexDigit:P,id:b,messageFormatElement:u,messageFormatPattern:s,messageFormatPatternRight:l,offsetPattern:f,pluralFormatPattern:p,pluralForms:m,pluralStyle:d,selectFormatPattern:v,selectStyle:h,start:a,string:_,stringKey:g,whitespace:T};if(void 0!==t){if(void 0===O[t])throw Error("Invalid rule name: "+r(t)+".")}else t="start";var D=0,L=!0,x=0,k=[],A={},I=O[t]();if(null===I||D!==e.length){var R=C();throw new this.SyntaxError(S(),R.line,R.column)}return I},toSource:function(){return this._source}};return e.SyntaxError=function(e,t,n){this.name="SyntaxError",this.message=e,this.line=t,this.column=n},e.SyntaxError.prototype=Error.prototype,e}();t.prototype.parse=function(){return n.parse.apply(n,arguments)},t.prototype.precompile=function(e){function n(e,a){a=a||{};var s,l,u,c="";switch(e.type){case"program":return n(e.program);case"messageFormatPattern":for(s=0;e.statements.length>s;++s)c+=n(e.statements[s],a);return o.begin+c+o.end;case"messageFormatPatternRight":for(s=0;e.statements.length>s;++s)c+=n(e.statements[s],a);return c;case"messageFormatElement":return a.pf_count=a.pf_count||0,c+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n',e.output?c+='r += d["'+e.argumentIndex+'"];\n':(u="lastkey_"+(a.pf_count+1),c+="var "+u+' = "'+e.argumentIndex+'";\n',c+="var k_"+(a.pf_count+1)+"=d["+u+"];\n",c+=n(e.elementFormat,a)),c;case"elementFormat":return"select"===e.key?(c+=n(e.val,a),c+="r += (pf_"+a.pf_count+"[ k_"+(a.pf_count+1)+" ] || pf_"+a.pf_count+'[ "other" ])( d );\n'):"plural"===e.key&&(c+=n(e.val,a),c+="if ( pf_"+a.pf_count+"[ k_"+(a.pf_count+1)+' + "" ] ) {\n',c+="r += pf_"+a.pf_count+"[ k_"+(a.pf_count+1)+' + "" ]( d ); \n',c+="}\nelse {\n",c+="r += (pf_"+a.pf_count+'[ MessageFormat.locale["'+i.fallbackLocale+'"]( k_'+(a.pf_count+1)+" - off_"+a.pf_count+" ) ] || pf_"+a.pf_count+'[ "other" ] )( d );\n',c+="}\n"),c;case"pluralFormatPattern":for(a.pf_count=a.pf_count||0,c+="var off_"+a.pf_count+" = "+e.offset+";\n",c+="var pf_"+a.pf_count+" = { \n",r=!0,s=0;e.pluralForms.length>s;++s)"other"===e.pluralForms[s].key&&(r=!1),l?c+=",\n":l=1,c+='"'+e.pluralForms[s].key+'" : '+n(e.pluralForms[s].val,function(){var e=JSON.parse(JSON.stringify(a));return e.pf_count++,e}());if(c+="\n};\n",r)throw Error("No 'other' form found in pluralFormatPattern "+a.pf_count);return c;case"selectFormatPattern":for(a.pf_count=a.pf_count||0,c+="var off_"+a.pf_count+" = 0;\n",c+="var pf_"+a.pf_count+" = { \n",r=!0,s=0;e.pluralForms.length>s;++s)"other"===e.pluralForms[s].key&&(r=!1),l?c+=",\n":l=1,c+='"'+e.pluralForms[s].key+'" : '+n(e.pluralForms[s].val,function(){var e=JSON.parse(JSON.stringify(a));return e.pf_count++,e}());if(c+="\n};\n",r)throw Error("No 'other' form found in selectFormatPattern "+a.pf_count);return c;case"string":return'r += "'+t.Utils.numSub(t.Utils.escapeExpression(e.val),"k_"+a.pf_count+" - off_"+(a.pf_count-1),a.pf_count)+'";\n';default:throw Error("Bad AST type: "+e.type)}}var i=this,r=!1,o={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return n(e)},t.prototype.compile=function(e){return Function("MessageFormat","return "+this.precompile(this.parse(e)))(t)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.MessageFormat=t):"function"==typeof define&&define.amd?define(function(){return t}):e.MessageFormat=t})(this);